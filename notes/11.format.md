# format 関数


ざっくり言えば、テキスト表示関数

XML, HTML, Lisp 設定ファイル
どのようなテキスト形式でも簡単に

```lisp
(format <output> "format string ~$" ...params)
```

出力先を第二引数にセット
- nil : 出力しない。関数の戻り値で string を返す (sprintf)
- t (bool) : stdout
- stream : 任意の出力ストリーム

# 制御文字列
二番目の引数
テキストの整形フォーマット

`~a` = all

- ~$ : 小数を含む数値
- ~s : 区切り文字付き。Lispで扱いやすい。 "foo" -> "foo"
- ~a : 人間に読みやすい(princ)。 "foo" -> foo
- ~10a , ~10s : 10も自分のスペース。足りない部分は空白
- ~10@a : 右詰め
- , : 制御シーケンスへのパラメータを複数渡す
  - 例 ~10@,3a

数値
- ~x : 16進数
- ~b : ２進数
- ~d : 10進数
- ~f : float
- ~$ : ドル表示(通貨の)
- ~a : (数値の場合) 10進数

pi = 3.14...
最初から定数で定義されてる


# 改行

- terpri コマンド
- fresh-line コマンド
  - カーソルが行頭にないときだけ改行

どっちも、thunk のように使える

# format 関数での改行

制御シーケンスをフォーマット文字列に加えると、そのタイミングで実行

- ~% : terpri に相当
- ~& : fresh-line に相当
- ~5%, ~5& : 5 line 文改行　(&だと意味ない？)

# 表を出力

~t シーケンス

~nt : n の部分が、文字のカラム。指定した部分から出力し始める

```lisp
(loop repeat 10
  do (format t "~5t~d ~15t~d ~25t~d~%"
    (random 10000)
    (random 10000)
    (random 10000)))
     1503      8057      9708
     5836      6506      8115
     5797      262       1866
     6515      2336      6220
     6311      766       595
     3457      7159      4722
     1666      7282      6218
     5357      5659      3850
     7054      6773      5849
     7837      9338      9711
```

各カラムが、10文字づつスペースを取ってある。
カラムに出力する文字が増えても、後ろのカラムがずれない

# format 関数の本質
制御シーケンスがたくさんあり、それだけで1つのプログラミング言語とも言える
多くの Lisper は format 関数を DSL とみなしてる


# loop format
`~{Iam  ~a !~} '(a b c)` => `Iam a !Iam b!Iam c!`

`~{` と `~}` に挟まれた範囲は、リストを取ってフォーマットを繰り返し、結果を連結する

フォーマット文字列が 2 つあれば、リストの要素が 2 つづつ消費される(nested list とかではなく)

ぶっちゃけ、`mapcar` して `concatenate` でいい気がする。





